# Release Trust Verification (v0.1)

This document defines how to verify release artifacts produced by CI and how to roll back provenance steps safely if needed.

## Scope

- Trust hardening only; no runtime behavior changes.
- Applies to CI runs on `main` and tags matching `v*`.

## What CI now produces

From `.github/workflows/ci.yml` `release-trust` job:

1. Release binaries:
- `dist/vifei`
- `dist/bench_tour`

2. Checksum manifest:
- `dist/sha256sums.txt`

3. Uploaded artifact bundle:
- `release-bundle-<git-sha>`

4. Artifact provenance attestation:
- generated by `actions/attest-build-provenance@v1` for `dist/*`

## Reproducible local build and packaging

Use the same script path as CI:

```bash
scripts/release_artifacts.sh dist
scripts/verify_release_artifacts.sh dist
```

This produces:

- `dist/vifei`
- `dist/bench_tour`
- `dist/sha256sums.txt`

## Verification workflow

### 1) Download release bundle

Use GitHub UI or CLI to download the `release-bundle-<sha>` artifact from the workflow run.

### 2) Verify checksums locally

From the extracted bundle directory:

```bash
scripts/verify_release_artifacts.sh dist
```

Expected result:
- all listed files report `OK`.

### 3) Verify provenance attestation

Verify using GitHub's attestation tooling. Example with `gh`:

```bash
gh attestation verify dist/vifei --repo <owner>/<repo>
gh attestation verify dist/bench_tour --repo <owner>/<repo>
```

Expected result:
- verification succeeds and reports provenance tied to this repository workflow.

## Operational notes

- Attestation is currently CI-only trust metadata; it does not alter any product artifact format.
- Local deterministic proof surfaces (`metrics.json`, `viewmodel.hash`, `ansi.capture`, `timetravel.capture`) remain unchanged.

## Rollback guidance

If provenance tooling causes release friction, use this rollback order:

1. Keep checksums (`sha256sums.txt`) and uploaded artifact bundle in place.
2. Temporarily disable only the `Attest release artifact provenance` step in `ci.yml`.
3. If needed, disable the entire `release-trust` job while preserving the existing `check` job.

Do not change core determinism or truth-path logic as part of rollback.
